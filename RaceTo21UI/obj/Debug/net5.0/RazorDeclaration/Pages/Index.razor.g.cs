// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace RaceTo21UI.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "/Users/maggieweng/Desktop/RaceTo21UI/RaceTo21UI/_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "/Users/maggieweng/Desktop/RaceTo21UI/RaceTo21UI/_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "/Users/maggieweng/Desktop/RaceTo21UI/RaceTo21UI/_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "/Users/maggieweng/Desktop/RaceTo21UI/RaceTo21UI/_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "/Users/maggieweng/Desktop/RaceTo21UI/RaceTo21UI/_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "/Users/maggieweng/Desktop/RaceTo21UI/RaceTo21UI/_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "/Users/maggieweng/Desktop/RaceTo21UI/RaceTo21UI/_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "/Users/maggieweng/Desktop/RaceTo21UI/RaceTo21UI/_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "/Users/maggieweng/Desktop/RaceTo21UI/RaceTo21UI/_Imports.razor"
using RaceTo21UI;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "/Users/maggieweng/Desktop/RaceTo21UI/RaceTo21UI/_Imports.razor"
using RaceTo21UI.Shared;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/")]
    public partial class Index : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 225 "/Users/maggieweng/Desktop/RaceTo21UI/RaceTo21UI/Pages/Index.razor"
      
    Game raceTo21;

    protected override void OnInitialized()
    {
        raceTo21 = new Game(new CardTable());
    }

    public void StartPlay()
    {//names filled in the blanks
        raceTo21.numberOfPlayers = raceTo21.players.FindAll(p => p.name != "").Count;
        raceTo21.nextTask = GameTask.PlayerTurn;

        foreach (var player in raceTo21.players)
        {
            Card card = raceTo21.deck.DealTopCard();
            player.cards.Add(card);
            player.score = raceTo21.ScoreHand(player);
        }
    }
    public void stay()
    {
        raceTo21.players[raceTo21.currentPlayer].status = PlayerStatus.stay;

        if (CheckWinner() == false)
        {
            NextPlayer();

        }
    }
    public void PickCard(int cardNumber)
    {
        Player player = raceTo21.players[raceTo21.currentPlayer];
        for (int i = 0; i < cardNumber; i++)
        {
            Card card = raceTo21.deck.DealTopCard();
            player.cards.Add(card);
            player.score = raceTo21.ScoreHand(player);
        }
        if (player.score > 21)
        {
            player.status = PlayerStatus.bust;
        }
        else if (player.score == 21)
        {
            player.status = PlayerStatus.win;
        }

        if (CheckWinner() == false)
        {
            NextPlayer();

        }

    }

    public void NextPlayer()
    {
        raceTo21.currentPlayer++;
        if (raceTo21.currentPlayer > raceTo21.numberOfPlayers - 1)
        {
            raceTo21.currentPlayer = 0; // back to the first player...
        }
    }

    public bool CheckWinner()
    {
        if (!raceTo21.CheckActivePlayers())
        {
            Player winner = raceTo21.DoFinalScoring();
            winner.status = PlayerStatus.win;


            raceTo21.cardTable.AnnounceWinner(winner);
            raceTo21.nextTask = GameTask.CheckForNewRound;

            return true;
        }
        return false;
    }
    public void RemovePlayer(int playerIndex)
    {
        raceTo21.players[playerIndex] = new Player("");
        raceTo21.numberOfPlayers--;
    }
    public void NewGame()
    {
        if (raceTo21.numberOfPlayers < 2)
        {
            raceTo21 = new Game(new CardTable());
        }
        else
        {
            //排序，剩余玩家集合
            raceTo21.players = raceTo21.players.OrderByDescending(p => p.name).ToList();
            raceTo21.ShufflePlayer();//the players will have a new sequence
            for (int i=0;i < raceTo21.numberOfPlayers;i++)
            {
                raceTo21.players[i].Reset();
            }
            raceTo21.nextTask = GameTask.PlayerTurn;
            raceTo21.deck = new Deck();
            raceTo21.deck.Shuffle();
            raceTo21.currentPlayer = 0;
            foreach (var player in raceTo21.players)
            {
                Card card = raceTo21.deck.DealTopCard();
                player.cards.Add(card);
                player.score = raceTo21.ScoreHand(player);
            }
        }
    }

#line default
#line hidden
#nullable disable
    }
}
#pragma warning restore 1591
